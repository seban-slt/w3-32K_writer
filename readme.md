Weekend 3+ Cartridge software
=============================

This software is created for the "Weekend 3+ 32KB cartridge". The cartridge is a a relic of the past, found by Galtron in his chest with old hardware, but no software was available for this unit. This cartridge was so unique that I decided to write a simple software for it that would bring it back to life. To speed things up the original unit was handed over to Zenon/Dial. He reverse engineered the schematic near the end of 2019. He also described the bank switchich scheme, and many other details about this old piece of hardware.

**So big thanks to Galtron and Zenon, without their help this software will never be created.**

Hardware description
--------------------

The cartridge contain some simple TTL logic and 32KB of Static Random Memory with battery backup, so the content of the SRAM is preserved after turning off the main power.

Cartridge can work in two modes, one is "read mode", so the computer can start from cartridge and run programm "programmed" on it earlier.

In this mode cartridge maps first page (256 bytes) of SRAM memory on two areas:

	$A000-$BFFF (and repeats the 256 byte window by 32 times in that area)
	$D500-$D5FF

When the 1st page of SRAM is mapped at $A000-$BFFF, and it content have a proper code (not so long code, this startup code must fit in 256 bytes), then OS can init and start this code during startup of the machine.

Any writes to $D500-$D5FF area in this mode (Read Mode) do two things. One is that the cartridge visibility from $A000-$BFFF will be disabled after 1st write, and the page/bank visible at $D500-$D5FF area will changed to next one. But also the write to that area at this moment modifies the written location! So if we want to disable the cartridge and do not destroy SRAM data, we must read the data from $D5xx area and then write it back. 

	lda $d500
	sta $d500

Next we have the 2nd mode, the “program mode”:

If You want to programm the cartridge, there must be a possibility to disable the cartridge start at system boot-up. To to this, the the red switch located and the end of cartridge must be placed in the "program mode” position. In this mode You can start the computer without running the cartridge (Atari OS doesn't see the cart at $A000-$BFFF area, SRAM is only mapped at $D500-$D5FF), and then it is possible to program the SRAM memory by writing to this area. Of course because of size of this area, only one sector/page is visible at this area, but every write to this memory area also switches the visible SRAM page/bankt to next 256-byte sector/page. This implies a some additional effort during programming, but it's not so hard to do at all.

The Cartridge
-------------

The photos of cartridge was provided by the Galtron. The schematics and the PCB layout with “decoded” IC part numbers was provided by Zenon. The cart originally has all the names of IC scratched/erased, but this not was any problem for Zenon. After opening the unit Zenon quickly realized what was going on, and send first version of schematics with description of all IC’s and bank-scheme switching. Only 8-bit of address lines of SRAM memory is connected directly to the Atari address bus (A0...A7), next addresses is generated by the 7493 TTL counters, that is counting up, when any access to the $D500-$D5FF area is detected (~CCTL signal is going from 1 to 0).

Usage
-----

Software must be run from DOS, because it’s uses the standard CIO routines to read files from any medium that is installed dusrig the boot-up of the Atari OS.

After booting the DOS, and running the software, the command prompt should appear, So when You see the:

    CMD>

The program is ready to work. The available commands are:

* “?”, “HELP” --> show list of commands
* “DOS” --> exit to DOS
* “CLS” --> clear the screen
* “DIR” --> shows the directory of disk (default filespec is D:*.*, but it is possible to type anything, e.g. “DIR H4:*.XEX”
* “LOAD dev:filename.ext” --> loads the selected file from selected device, e.g. “LOAD D8:SFDN.XEX”
* “PROG” --> starts the programming/writing module (the next instructions will show on new screen)
* “VERIFY” --> verifies the content of buffer with the SRAM content on cartridge. The data buffer is compared, but also the proper boot-loader code must present to start the verification procedure.

The user data buffer size is $7f00, the `*.xex` loader uses one page, so $100+$7F00 is $8000 the size of SRAM that is present in the cartridge.


The Loader
----------

The programming software puts on the 1st page of SRAM memory a startup code, with AtariDOS file loader. So the only Atari-DOS files can be placed on the cartridge. The loader is very short, so it is very simple. The .XEX file placed on cart must have a proper RUN segment [$2E0-$2E1] or must be run by the INIT segment [$2E2-$2E3]. This software can’t run BASIC, BOOT or any other file types. Only Atari-DOS compatible files can be run from cartridge.

The loader is short, so the Mem-Lo of loader is at $800. The loader occupies $700-$780 memory area but some variables is placed at $7FA,$7FB locations, so as I said the minimal address of loaded file is $800. Loader don’t use any zero-page location. The only used addressed is $700-$780 and $7FA,$7FB and of course $D500-$D5FF area as a SRAM window.

The Code
--------

the code is divided into two files:

`w3_prox.xsm` - this is main code for the program
`loader.xsm` - this is loader code. The loader code is included by `w3_prog.xsm` and then placed at 1st page/sector of SRAM memory during programming the cartridge. On next pages of memory is located the file that was loaded into buffer before programming the cartridge.

The code is written in 6502 assembly language, and to compile you must use the [XASM assembler](https://github.com/pfusik/xasm) by 0xF (a.k.a Piotr Fusik)

Poetic License
--------------

This work 'as-is' we provide.  
No warranty express or implied.  
We've done our best,  
to debug and test.  
Liability for damages denied.

Permission is granted hereby,  
to copy, share, and modify.  
Use as is fit,  
free or for profit.  
These rights, on this notice, rely.  




